<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF转Excel服务 - 智能订单处理平台</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-file-excel"></i> PDF转Excel服务</h1>
                <p>快速、准确地将PDF表格转换为Excel文件，并提供智能订单核对功能</p>
            </div>
            
            <!-- 功能导航 -->
            <nav class="nav-tabs">
                <button class="nav-tab active" data-tab="pdf-convert">
                    <i class="fas fa-file-pdf"></i> PDF转换
                </button>
                <button class="nav-tab" data-tab="order-check">
                    <i class="fas fa-search"></i> 订单核对
                </button>
                <button class="nav-tab" data-tab="spec-manage">
                    <i class="fas fa-cogs"></i> 规格管理
                </button>
            </nav>
        </header>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- PDF转换功能 -->
            <div id="pdf-convert-tab" class="tab-content active">
                <!-- 上传区域 -->
                <section id="upload-section" class="section active">
                    <div class="upload-container">
                        <div class="upload-area" id="upload-area">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h3>拖拽PDF文件到此处或点击选择</h3>
                            <p>支持PDF格式，最大文件大小50MB</p>
                            <input type="file" id="file-input" accept=".pdf" hidden>
                            <button class="btn btn-primary" id="select-file-btn">
                                <i class="fas fa-folder-open"></i> 选择文件
                            </button>
                        </div>
                        
                        <div class="file-info" id="file-info" style="display: none;">
                            <div class="file-details">
                                <i class="fas fa-file-pdf"></i>
                                <div class="file-text">
                                    <span class="file-name" id="file-name"></span>
                                    <span class="file-size" id="file-size"></span>
                                </div>
                                <button class="btn btn-secondary btn-small" id="change-file-btn">
                                    <i class="fas fa-edit"></i> 更换文件
                                </button>
                            </div>
                            <button class="btn btn-success" id="upload-btn">
                                <i class="fas fa-upload"></i> 开始转换
                            </button>
                        </div>
                    </div>
                </section>

                <!-- 处理中区域 -->
                <section id="processing-section" class="section">
                    <div class="processing-container">
                        <div class="processing-animation">
                            <div class="spinner"></div>
                        </div>
                        <h3>正在转换PDF文件...</h3>
                        <p>请稍候，我们正在处理您的文件</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <button class="btn btn-secondary" id="cancel-btn">
                            <i class="fas fa-times"></i> 取消
                        </button>
                    </div>
                </section>

                <!-- 结果区域 -->
                <section id="result-section" class="section">
                    <div class="result-container">
                        <div class="result-header">
                            <div class="result-icon success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3>转换完成！</h3>
                            <p>您的PDF文件已成功转换为Excel格式</p>
                        </div>
                        
                        <div class="result-actions">
                            <button class="btn btn-primary" id="download-btn">
                                <i class="fas fa-download"></i> 下载Excel文件
                            </button>
                            <button class="btn btn-secondary" id="preview-btn">
                                <i class="fas fa-eye"></i> 预览
                            </button>
                            <button class="btn btn-info" id="new-conversion-btn">
                                <i class="fas fa-plus"></i> 转换新文件
                            </button>
                        </div>

                        <!-- 预览区域 -->
                        <div class="preview-container" id="preview-container" style="display: none;">
                            <h4>文件预览</h4>
                            <div class="table-container" id="table-container">
                                <!-- 表格内容将通过JavaScript动态加载 -->
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- 已转换文件列表区域 -->
                <section id="converted-files-section" class="section active">
                    <div class="converted-files-container">
                        <div class="section-header">
                            <h3><i class="fas fa-file-excel"></i> 已转换的文件</h3>
                            <p>管理您已转换的Excel文件</p>
                        </div>
                        
                        <div class="list-header">
                            <h4>订单文档管理</h4>
                            <div class="header-actions">
                                <button class="btn btn-secondary btn-small" id="refresh-converted-files-btn">
                                    <i class="fas fa-sync"></i> 刷新列表
                                </button>
                                <button class="btn btn-info btn-small" id="batch-preview-btn" style="display: none;">
                                    <i class="fas fa-eye"></i> 批量预览
                                </button>
                                <button class="btn btn-warning btn-small" id="batch-download-btn" style="display: none;">
                                    <i class="fas fa-download"></i> 批量下载
                                </button>
                                <button class="btn btn-danger btn-small" id="batch-delete-btn" style="display: none;">
                                    <i class="fas fa-trash"></i> 批量删除
                                </button>
                            </div>
                        </div>
                        
                        <!-- 文件统计信息 -->
                        <div class="file-stats" id="file-stats" style="display: none;">
                            <div class="stats-item">
                                <i class="fas fa-file-excel"></i>
                                <span>总文件数: <strong id="total-files">0</strong></span>
                            </div>
                            <div class="stats-item">
                                <i class="fas fa-database"></i>
                                <span>总记录数: <strong id="total-records">0</strong></span>
                            </div>
                            <div class="stats-item">
                                <i class="fas fa-hdd"></i>
                                <span>总大小: <strong id="total-size">0 MB</strong></span>
                            </div>
                            <div class="stats-item">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>缺失文件: <strong id="missing-files">0</strong></span>
                            </div>
                        </div>
                        
                        <!-- 全选控制 -->
                        <div class="select-all-container" id="select-all-container" style="display: none;">
                            <input type="checkbox" id="select-all-checkbox" onchange="toggleSelectAll()">
                            <label for="select-all-checkbox">全选/取消全选</label>
                            <span class="selected-count" id="selected-count">已选择 0 个文件</span>
                        </div>
                        
                        <!-- 新的文件列表显示方式 -->
                        <div id="converted-files-list" class="converted-files-list">
                            <!-- 文件列表将通过JavaScript动态加载 -->
                        </div>
                        
                        <!-- 保留原来的表格，但不显示 -->
                        <div class="file-table-container" style="display: none;">
                            <table class="file-table" id="converted-files-table">
                                <thead>
                                    <tr>
                                        <th>文件名</th>
                                        <th>记录数</th>
                                        <th>转换时间</th>
                                        <th>文件大小</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="converted-files-body">
                                    <!-- 文件列表将通过JavaScript动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>

            <!-- 订单核对功能 -->
            <div id="order-check-tab" class="tab-content">
                <section class="section active">
                    <div class="check-container">
                        <div class="check-header">
                            <h2><i class="fas fa-search"></i> 订单与规格表核对</h2>
                            <p>将转换后的订单表格与产品规格表进行智能比对，识别数据不一致问题</p>
                        </div>

                        <!-- 文件选择区域 -->
                        <div class="file-selection">
                            <div class="selection-group">
                                <label><i class="fas fa-file-excel"></i> 选择订单表格</label>
                                <select id="order-file-select" class="file-select">
                                    <option value="">请选择已转换的订单文件...</option>
                                </select>
                                <button class="btn btn-secondary btn-small" id="refresh-orders-btn">
                                    <i class="fas fa-sync"></i> 刷新
                                </button>
                            </div>

                            <div class="selection-group">
                                <label><i class="fas fa-cogs"></i> 选择产品规格表</label>
                                <select id="spec-file-select" class="file-select">
                                    <option value="">请选择产品规格表...</option>
                                </select>
                                <button class="btn btn-secondary btn-small" id="refresh-specs-btn">
                                    <i class="fas fa-sync"></i> 刷新
                                </button>
                            </div>
                        </div>

                        <!-- 比对选项 -->
                        <div class="check-options">
                            <h4>比对选项</h4>
                            <div class="option-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="check-total-calc" checked>
                                    <span class="checkmark"></span>
                                    检查总价计算是否正确
                                </label>
                            </div>
                        </div>

                        <!-- 开始比对按钮 -->
                        <div class="check-actions">
                            <button class="btn btn-success btn-large" id="start-check-btn" disabled>
                                <i class="fas fa-play"></i> 开始核对
                            </button>
                        </div>

                        <!-- 比对进度 -->
                        <div class="check-progress" id="check-progress" style="display: none;">
                            <div class="processing-animation">
                                <div class="spinner"></div>
                            </div>
                            <h4>正在进行订单核对...</h4>
                            <p>请稍候，正在比对数据...</p>
                        </div>

                        <!-- 比对结果 -->
                        <div class="check-results" id="check-results" style="display: none;">
                            <div class="result-summary">
                                <h4>核对结果摘要</h4>
                                <div class="summary-stats">
                                    <div class="stat-item">
                                        <span class="stat-number" id="total-records">0</span>
                                        <span class="stat-label">总记录数</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-number success" id="pass-records">0</span>
                                        <span class="stat-label">通过记录</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-number error" id="error-records">0</span>
                                        <span class="stat-label">问题记录</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-number" id="pass-rate">0%</span>
                                        <span class="stat-label">通过率</span>
                                    </div>
                                </div>
                            </div>

                            <div class="error-breakdown" id="error-breakdown">
                                <h4>错误类型统计</h4>
                                <div class="error-list" id="error-list">
                                    <!-- 错误统计将通过JavaScript动态生成 -->
                                </div>
                            </div>

                            <div class="result-actions">
                                <button class="btn btn-primary" id="download-result-btn">
                                    <i class="fas fa-download"></i> 下载核对结果
                                </button>
                                <button class="btn btn-secondary" id="preview-result-btn">
                                    <i class="fas fa-eye"></i> 预览结果
                                </button>
                            </div>

                            <!-- 结果预览 -->
                            <div class="result-preview" id="result-preview" style="display: none;">
                                <h4>核对结果预览</h4>
                                <div class="table-container" id="result-table-container">
                                    <!-- 结果表格将通过JavaScript动态加载 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- 规格管理功能 -->
            <div id="spec-manage-tab" class="tab-content">
                <section class="section active">
                    <div class="spec-container">
                        <div class="spec-header">
                            <h2><i class="fas fa-cogs"></i> 产品规格表管理</h2>
                            <p>上传和管理产品规格表，用于订单数据核对</p>
                        </div>

                        <!-- 上传规格表 -->
                        <div class="spec-upload">
                            <h4>上传新的规格表</h4>
                            
                            <!-- 格式说明 -->
                            <div class="format-info">
                                <h5><i class="fas fa-info-circle"></i> 规格表格式要求</h5>
                                <p>Excel文件必须包含必需的列（系统支持多种列名格式）：</p>
                                <div class="required-columns" id="format-required-columns">
                                    <span class="column-tag">item_id</span>
                                    <span class="column-tag">product_name</span>
                                    <span class="column-tag">standard_unit_price</span>
                                </div>
                                <p class="format-hint">系统支持灵活的列名映射，可以自动识别常见的列名变体。</p>
                                <div class="format-actions">
                                    <button class="btn btn-info btn-small" id="download-template-btn">
                                        <i class="fas fa-download"></i> 下载模板文件
                                    </button>
                                    <button class="btn btn-secondary btn-small" id="show-format-guide-btn">
                                        <i class="fas fa-book"></i> 查看详细格式指南
                                    </button>
                                </div>
                            </div>
                            
                            <div class="upload-area" id="spec-upload-area">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <h5>拖拽Excel文件到此处或点击选择</h5>
                                <p>支持.xlsx和.xls格式，最大文件大小50MB</p>
                                <input type="file" id="spec-file-input" accept=".xlsx,.xls" hidden>
                                <button class="btn btn-primary" id="select-spec-btn">
                                    <i class="fas fa-folder-open"></i> 选择规格表文件
                                </button>
                            </div>

                            <div class="spec-file-info" id="spec-file-info" style="display: none;">
                                <div class="file-details">
                                    <i class="fas fa-file-excel"></i>
                                    <div class="file-text">
                                        <span class="file-name" id="spec-file-name"></span>
                                        <span class="file-size" id="spec-file-size"></span>
                                    </div>
                                    <button class="btn btn-secondary btn-small" id="change-spec-btn">
                                        <i class="fas fa-edit"></i> 更换文件
                                    </button>
                                </div>
                                <button class="btn btn-success" id="upload-spec-btn">
                                    <i class="fas fa-upload"></i> 上传规格表
                                </button>
                            </div>
                        </div>

                        <!-- 规格表列表 -->
                        <div class="spec-list">
                            <div class="list-header">
                                <h4>已上传的规格表</h4>
                                <button class="btn btn-secondary btn-small" id="refresh-spec-list-btn">
                                    <i class="fas fa-sync"></i> 刷新列表
                                </button>
                            </div>
                            
                            <div class="spec-table-container">
                                <table class="spec-table" id="spec-table">
                                    <thead>
                                        <tr>
                                            <th>文件名</th>
                                            <th>记录数</th>
                                            <th>上传时间</th>
                                            <th>文件大小</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="spec-table-body">
                                        <!-- 规格表列表将通过JavaScript动态加载 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- 错误提示 -->
        <div class="error-message" id="error-message" style="display: none;">
            <div class="error-content">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="error-text"></span>
                <button class="error-close" id="error-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- 成功提示 -->
        <div class="success-message" id="success-message" style="display: none;">
            <div class="success-content">
                <i class="fas fa-check-circle"></i>
                <span id="success-text"></span>
                <button class="success-close" id="success-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <!-- 警告提示 -->
        <div class="warning-message" id="warning-message" style="display: none;">
            <div class="warning-content">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="warning-text"></span>
                <button class="warning-close" id="warning-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- 加载遮罩 -->
        <div class="loading-overlay" id="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="spinner large"></div>
                <p>处理中，请稍候...</p>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="format_guide.js"></script>
    <script src="mapping_dialog.js"></script>
    <script src="error_feedback.js"></script>
</body>
</html>
